!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@angular/cdk/drag-drop"),require("@angular/common"),require("@angular/core"),require("rxjs"),require("lodash")):"function"==typeof define&&define.amd?define("ngx-chess-board",["exports","@angular/cdk/drag-drop","@angular/common","@angular/core","rxjs","lodash"],t):t((e=e||self)["ngx-chess-board"]={},e.ng.cdk["drag-drop"],e.ng.common,e.ng.core,e.rxjs,e.lodash)}(this,(function(e,t,o,i,r,s){"use strict";
/*! *****************************************************************************
    Copyright (c) Microsoft Corporation.

    Permission to use, copy, modify, and/or distribute this software for any
    purpose with or without fee is hereby granted.

    THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
    REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
    AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
    INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
    LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
    OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
    PERFORMANCE OF THIS SOFTWARE.
    ***************************************************************************** */var n=function(e,t){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o])})(e,t)};function a(e,t){function o(){this.constructor=e}n(e,t),e.prototype=null===t?Object.create(t):(o.prototype=t.prototype,new o)}var c=function(){return(c=Object.assign||function(e){for(var t,o=1,i=arguments.length;o<i;o++)for(var r in t=arguments[o])Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e}).apply(this,arguments)};function h(e,t){var o="function"==typeof Symbol&&e[Symbol.iterator];if(!o)return e;var i,r,s=o.call(e),n=[];try{for(;(void 0===t||t-- >0)&&!(i=s.next()).done;)n.push(i.value)}catch(e){r={error:e}}finally{try{i&&!i.done&&(o=s.return)&&o.call(s)}finally{if(r)throw r.error}}return n}function d(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(h(arguments[t]));return e}var l={WHITE:0,BLACK:1};l[l.WHITE]="WHITE",l[l.BLACK]="BLACK";var p=function(e,t,o,i,r){this.checkPoints=[],this.color=t,this.constant=o,this.point=e,this.relValue=i,this.board=r};var u=function(){function e(e,t){this.row=e,this.col=t}return e.prototype.isEqual=function(e){return e&&this.row===e.row&&this.col===e.col},e.prototype.hasCoordsEqual=function(e,t){return e&&t&&this.row===e&&this.col===t},e}();var b=function(e){function t(t,o,i,r){var s=e.call(this,t,o,i,5,r)||this;return s.isMovedAlready=!1,s}return a(t,e),t.prototype.getPossibleMoves=function(){for(var e=[],t=this.point.row,o=this.point.col,i=t+1;i<8&&this.board.isFieldEmpty(i,o);++i)e.push(new u(i,o));for(i=t-1;i>=0&&this.board.isFieldEmpty(i,o);--i)e.push(new u(i,o));for(var r=o-1;r>=0&&this.board.isFieldEmpty(t,r);--r)e.push(new u(t,r));for(r=o+1;r<8&&this.board.isFieldEmpty(t,r);++r)e.push(new u(t,r));return e},t.prototype.getPossibleCaptures=function(){for(var e=[],t=this.point.row,o=this.point.col,i=t+1;i<8;++i){if(this.board.isFieldTakenByEnemy(i,o,this.color===l.WHITE?l.BLACK:l.WHITE)){e.push(new u(i,o));break}if(!this.board.isFieldEmpty(i,o))break}for(i=t-1;i>=0;--i){if(this.board.isFieldTakenByEnemy(i,o,this.color===l.WHITE?l.BLACK:l.WHITE)){e.push(new u(i,o));break}if(!this.board.isFieldEmpty(i,o))break}for(var r=o-1;r>=0;--r){if(this.board.isFieldTakenByEnemy(t,r,this.color===l.WHITE?l.BLACK:l.WHITE)){e.push(new u(t,r));break}if(!this.board.isFieldEmpty(t,r))break}for(r=o+1;r<8;++r){if(this.board.isFieldTakenByEnemy(t,r,this.color===l.WHITE?l.BLACK:l.WHITE)){e.push(new u(t,r));break}if(!this.board.isFieldEmpty(t,r))break}return e},t.prototype.getCoveredFields=function(){for(var e=[],t=this.point.row,o=this.point.col,i=t+1;i<8;++i)if(this.board.isFieldEmpty(i,o))e.push(new u(i,o));else if(!(this.board.getPieceByField instanceof f)){e.push(new u(i,o));break}for(i=t-1;i>=0;--i)if(this.board.isFieldEmpty(i,o))e.push(new u(i,o));else if(!(this.board.getPieceByField instanceof f)){e.push(new u(i,o));break}for(var r=o-1;r>=0;--r)if(this.board.isFieldEmpty(t,r))e.push(new u(t,r));else if(!(this.board.getPieceByField instanceof f)){e.push(new u(t,r));break}for(r=o+1;r<8;++r)if(this.board.isFieldEmpty(t,r))e.push(new u(t,r));else if(!(this.board.getPieceByField instanceof f)){e.push(new u(t,r));break}return e},t}(p);var f=function(e){function t(t,o,i,r){var s=e.call(this,t,o,i,0,r)||this;return s.castledAlready=!1,s.shortCastled=!1,s.longCastled=!1,s.isCastling=!1,s}return a(t,e),t.prototype.getPossibleMoves=function(){var e=[],t=this.point.row,o=this.point.col;if(this.board.isFieldEmpty(t,o-1)&&!this.board.isFieldUnderAttack(t,o-1,this.color===l.WHITE?l.BLACK:l.WHITE)&&e.push(new u(t,o-1)),this.board.isFieldEmpty(t,o+1)&&!this.board.isFieldUnderAttack(t,o+1,this.color===l.WHITE?l.BLACK:l.WHITE)&&e.push(new u(t,o+1)),this.board.isFieldEmpty(t+1,o)&&!this.board.isFieldUnderAttack(t+1,o,this.color===l.WHITE?l.BLACK:l.WHITE)&&e.push(new u(t+1,o)),this.board.isFieldEmpty(t-1,o)&&!this.board.isFieldUnderAttack(t-1,o,this.color===l.WHITE?l.BLACK:l.WHITE)&&e.push(new u(t-1,o)),this.board.isFieldEmpty(t-1,o-1)&&!this.board.isFieldUnderAttack(t-1,o-1,this.color===l.WHITE?l.BLACK:l.WHITE)&&e.push(new u(t-1,o-1)),this.board.isFieldEmpty(t-1,o+1)&&!this.board.isFieldUnderAttack(t-1,o+1,this.color===l.WHITE?l.BLACK:l.WHITE)&&e.push(new u(t-1,o+1)),this.board.isFieldEmpty(t+1,o-1)&&!this.board.isFieldUnderAttack(t+1,o-1,this.color===l.WHITE?l.BLACK:l.WHITE)&&e.push(new u(t+1,o-1)),this.board.isFieldEmpty(t+1,o+1)&&!this.board.isFieldUnderAttack(t+1,o+1,this.color===l.WHITE?l.BLACK:l.WHITE)&&e.push(new u(t+1,o+1)),!this.isMovedAlready){for(var i=!0,r=o-1;r>0;--r)if(!this.board.isFieldEmpty(t,r)||this.board.isFieldUnderAttack(t,r,this.color===l.WHITE?l.BLACK:l.WHITE)){i=!1;break}if(i&&this.board.getPieceByField(t,0)){var s=this.board.getPieceByField(t,0);s instanceof b&&(s.isMovedAlready||e.push(new u(t,o-2)))}var n=!0;for(r=o+1;r<7;++r)if(!this.board.isFieldEmpty(t,r)||this.board.isFieldUnderAttack(t,r,this.color===l.WHITE?l.BLACK:l.WHITE)){n=!1;break}if(n&&this.board.getPieceByField(t,7)){var a=this.board.getPieceByField(t,7);a instanceof b&&(a.isMovedAlready||e.push(new u(t,o+2)))}}return e},t.prototype.getPossibleCaptures=function(){var e=[],t=this.point.row,o=this.point.col;return this.board.isFieldTakenByEnemy(t,o-1,this.color===l.WHITE?l.BLACK:l.WHITE)&&!this.board.isFieldUnderAttack(t,o-1,this.color===l.WHITE?l.BLACK:l.WHITE)&&e.push(new u(t,o-1)),this.board.isFieldTakenByEnemy(t,o+1,this.color===l.WHITE?l.BLACK:l.WHITE)&&!this.board.isFieldUnderAttack(t,o+1,this.color===l.WHITE?l.BLACK:l.WHITE)&&e.push(new u(t,o+1)),this.board.isFieldTakenByEnemy(t+1,o,this.color===l.WHITE?l.BLACK:l.WHITE)&&!this.board.isFieldUnderAttack(t+1,o,this.color===l.WHITE?l.BLACK:l.WHITE)&&e.push(new u(t+1,o)),this.board.isFieldTakenByEnemy(t-1,o,this.color===l.WHITE?l.BLACK:l.WHITE)&&!this.board.isFieldUnderAttack(t-1,o,this.color===l.WHITE?l.BLACK:l.WHITE)&&e.push(new u(t-1,o)),this.board.isFieldTakenByEnemy(t-1,o-1,this.color===l.WHITE?l.BLACK:l.WHITE)&&!this.board.isFieldUnderAttack(t-1,o-1,this.color===l.WHITE?l.BLACK:l.WHITE)&&e.push(new u(t-1,o-1)),this.board.isFieldTakenByEnemy(t-1,o+1,this.color===l.WHITE?l.BLACK:l.WHITE)&&!this.board.isFieldUnderAttack(t-1,o+1,this.color===l.WHITE?l.BLACK:l.WHITE)&&e.push(new u(t-1,o+1)),this.board.isFieldTakenByEnemy(t+1,o-1,this.color===l.WHITE?l.BLACK:l.WHITE)&&!this.board.isFieldUnderAttack(t+1,o-1,this.color===l.WHITE?l.BLACK:l.WHITE)&&e.push(new u(t+1,o-1)),this.board.isFieldTakenByEnemy(t+1,o+1,this.color===l.WHITE?l.BLACK:l.WHITE)&&!this.board.isFieldUnderAttack(t+1,o+1,this.color===l.WHITE?l.BLACK:l.WHITE)&&e.push(new u(t+1,o+1)),e},t.prototype.getCoveredFields=function(){var e=[],t=this.point.row,o=this.point.col;return this.board.isFieldTakenByEnemy(t,o-1,this.color)&&e.push(new u(t,o-1)),this.board.isFieldTakenByEnemy(t,o+1,this.color)&&e.push(new u(t,o+1)),this.board.isFieldTakenByEnemy(t+1,o,this.color)&&e.push(new u(t+1,o)),this.board.isFieldTakenByEnemy(t-1,o,this.color)&&e.push(new u(t-1,o)),this.board.isFieldTakenByEnemy(t-1,o-1,this.color)&&e.push(new u(t-1,o-1)),this.board.isFieldTakenByEnemy(t-1,o+1,this.color)&&e.push(new u(t-1,o+1)),this.board.isFieldTakenByEnemy(t+1,o-1,this.color)&&e.push(new u(t+1,o-1)),this.board.isFieldTakenByEnemy(t+1,o+1,this.color)&&e.push(new u(t+1,o+1)),e},t}(p);var y=function(e){function t(t,o,i,r){return e.call(this,t,o,i,3,r)||this}return a(t,e),t.prototype.getPossibleMoves=function(){for(var e=[],t=this.point.row,o=this.point.col,i=t-1,r=o-1;i>=0&&r>=0&&this.board.isFieldEmpty(i,r);--i,--r)e.push(new u(i,r));for(i=t-1,r=o+1;i>=0&&r<8&&this.board.isFieldEmpty(i,r);--i,++r)e.push(new u(i,r));for(i=t+1,r=o-1;i<8&&r>=0&&this.board.isFieldEmpty(i,r);++i,--r)e.push(new u(i,r));for(i=t+1,r=o+1;i<8&&r<8&&this.board.isFieldEmpty(i,r);++i,++r)e.push(new u(i,r));return e},t.prototype.getPossibleCaptures=function(){for(var e=[],t=this.point.row,o=this.point.col,i=t-1,r=o-1;i>=0&&r>=0;--i,--r){if(this.board.isFieldTakenByEnemy(i,r,this.color===l.WHITE?l.BLACK:l.WHITE)){e.push(new u(i,r));break}if(!this.board.isFieldEmpty(i,r))break}for(i=t-1,r=o+1;i>=0&&r<8;--i,++r){if(this.board.isFieldTakenByEnemy(i,r,this.color===l.WHITE?l.BLACK:l.WHITE)){e.push(new u(i,r));break}if(!this.board.isFieldEmpty(i,r))break}for(i=t+1,r=o-1;i<8&&r>=0;++i,--r){if(this.board.isFieldTakenByEnemy(i,r,this.color===l.WHITE?l.BLACK:l.WHITE)){e.push(new u(i,r));break}if(!this.board.isFieldEmpty(i,r))break}for(i=t+1,r=o+1;i<8&&r<8;++i,++r){if(this.board.isFieldTakenByEnemy(i,r,this.color===l.WHITE?l.BLACK:l.WHITE)){e.push(new u(i,r));break}if(!this.board.isFieldEmpty(i,r))break}return e},t.prototype.getCoveredFields=function(){for(var e=[],t=this.point.row,o=this.point.col,i=t-1,r=o-1;i>=0&&r>=0;--i,--r)if(this.board.isFieldEmpty(i,r))e.push(new u(i,r));else if(!(this.board.getPieceByField(i,r)instanceof f)){e.push(new u(i,r));break}for(i=t-1,r=o+1;i>=0&&r<8;--i,++r)if(this.board.isFieldEmpty(i,r))e.push(new u(i,r));else if(!(this.board.getPieceByField(i,r)instanceof f)){e.push(new u(i,r));break}for(i=t+1,r=o-1;i<8&&r>=0;++i,--r)if(this.board.isFieldEmpty(i,r))e.push(new u(i,r));else if(!(this.board.getPieceByField(i,r)instanceof f)){e.push(new u(i,r));break}for(i=t+1,r=o+1;i<8&&r<8;++i,++r)if(this.board.isFieldEmpty(i,r))e.push(new u(i,r));else if(!(this.board.getPieceByField(i,r)instanceof f)){e.push(new u(i,r));break}return e},t}(p),w=function(e){function t(t,o,i,r){var s=e.call(this,t,o,i,3,r)||this;return s.isMovedAlready=!1,s}return a(t,e),t.prototype.getPossibleMoves=function(){var e=[],t=this.point.row,o=this.point.col;return this.board.isFieldEmpty(t-2,o-1)&&e.push(new u(t-2,o-1)),this.board.isFieldEmpty(t-2,o+1)&&e.push(new u(t-2,o+1)),this.board.isFieldEmpty(t-1,o-2)&&e.push(new u(t-1,o-2)),this.board.isFieldEmpty(t-1,o+2)&&e.push(new u(t-1,o+2)),this.board.isFieldEmpty(t+1,o-2)&&e.push(new u(t+1,o-2)),this.board.isFieldEmpty(t+1,o+2)&&e.push(new u(t+1,o+2)),this.board.isFieldEmpty(t+2,o-1)&&e.push(new u(t+2,o-1)),this.board.isFieldEmpty(t+2,o+1)&&e.push(new u(t+2,o+1)),e},t.prototype.getPossibleCaptures=function(){var e=[],t=this.point.row,o=this.point.col;return this.board.isFieldTakenByEnemy(t-2,o-1,this.color===l.WHITE?l.BLACK:l.WHITE)&&e.push(new u(t-2,o-1)),this.board.isFieldTakenByEnemy(t-2,o+1,this.color===l.WHITE?l.BLACK:l.WHITE)&&e.push(new u(t-2,o+1)),this.board.isFieldTakenByEnemy(t-1,o-2,this.color===l.WHITE?l.BLACK:l.WHITE)&&e.push(new u(t-1,o-2)),this.board.isFieldTakenByEnemy(t-1,o+2,this.color===l.WHITE?l.BLACK:l.WHITE)&&e.push(new u(t-1,o+2)),this.board.isFieldTakenByEnemy(t+1,o-2,this.color===l.WHITE?l.BLACK:l.WHITE)&&e.push(new u(t+1,o-2)),this.board.isFieldTakenByEnemy(t+1,o+2,this.color===l.WHITE?l.BLACK:l.WHITE)&&e.push(new u(t+1,o+2)),this.board.isFieldTakenByEnemy(t+2,o-1,this.color===l.WHITE?l.BLACK:l.WHITE)&&e.push(new u(t+2,o-1)),this.board.isFieldTakenByEnemy(t+2,o+1,this.color===l.WHITE?l.BLACK:l.WHITE)&&e.push(new u(t+2,o+1)),e},t.prototype.getCoveredFields=function(){var e=[],t=this.point.row,o=this.point.col;return e.push(new u(t-2,o-1)),e.push(new u(t-2,o+1)),e.push(new u(t-1,o-2)),e.push(new u(t-1,o+2)),e.push(new u(t+1,o-2)),e.push(new u(t+1,o+2)),e.push(new u(t+2,o-1)),e.push(new u(t+2,o+1)),e},t}(p);var v=function(e){function t(t,o,i,r){var s=e.call(this,t,o,i,1,r)||this;return s.isMovedAlready=!1,s}return a(t,e),t.prototype.getPossibleMoves=function(){var e=[],t=this.point.row,o=this.point.col;return!this.board.reverted&&this.color===l.WHITE||this.board.reverted&&this.color===l.BLACK?this.board.isFieldEmpty(t-1,o)&&(e.push(new u(t-1,o)),!this.isMovedAlready&&this.board.isFieldEmpty(t-2,o)&&e.push(new u(t-2,o))):
/*!board.isFieldTakenByEnemy(row + 1, col, Color.WHITE) &&*/this.board.isFieldEmpty(t+1,o)&&(e.push(new u(t+1,o)),!this.isMovedAlready&&this.board.isFieldEmpty(t+2,o)&&e.push(new u(t+2,o))),e},t.prototype.getPossibleCaptures=function(){var e=[],t=this.point.row,o=this.point.col;return!this.board.reverted&&this.color===l.WHITE||this.board.reverted&&this.color===l.BLACK?(this.board.isFieldTakenByEnemy(t-1,o-1,this.color===l.WHITE?l.BLACK:l.WHITE)&&e.push(new u(t-1,o-1)),this.board.isFieldTakenByEnemy(t-1,o+1,this.color===l.WHITE?l.BLACK:l.WHITE)&&e.push(new u(t-1,o+1))):(this.board.isFieldTakenByEnemy(t+1,o-1,this.color===l.WHITE?l.BLACK:l.WHITE)&&e.push(new u(t+1,o-1)),this.board.isFieldTakenByEnemy(t+1,o+1,this.color===l.WHITE?l.BLACK:l.WHITE)&&e.push(new u(t+1,o+1))),this.board.enPassantPoint&&this.board.enPassantPiece.color===(this.color===l.WHITE?l.BLACK:l.WHITE)&&t===this.board.enPassantPiece.point.row&&1===Math.abs(this.board.enPassantPiece.point.col-o)&&e.push(this.board.enPassantPoint),e},t.prototype.getCoveredFields=function(){var e=[],t=this.point.row,o=this.point.col;return!this.board.reverted&&this.color===l.WHITE||this.board.reverted&&this.color===l.BLACK?(e.push(new u(t-1,o-1)),e.push(new u(t-1,o+1))):(e.push(new u(t+1,o-1)),e.push(new u(t+1,o+1))),e},t}(p);var E=function(e){function t(t,o,i,r){return e.call(this,t,o,i,9,r)||this}return a(t,e),t.prototype.getPossibleMoves=function(){for(var e=[],t=this.point.row,o=this.point.col,i=t-1,r=o-1;i>=0&&r>=0&&this.board.isFieldEmpty(i,r);--i,--r)e.push(new u(i,r));for(i=t-1,r=o+1;i>=0&&r<8&&this.board.isFieldEmpty(i,r);--i,++r)e.push(new u(i,r));for(i=t+1,r=o-1;i<8&&r>=0&&this.board.isFieldEmpty(i,r);++i,--r)e.push(new u(i,r));for(i=t+1,r=o+1;i<8&&r<8&&this.board.isFieldEmpty(i,r);++i,++r)e.push(new u(i,r));for(i=t+1;i<8&&this.board.isFieldEmpty(i,o);++i)e.push(new u(i,o));for(i=t-1;i>=0&&this.board.isFieldEmpty(i,o);--i)e.push(new u(i,o));for(r=o-1;r>=0&&this.board.isFieldEmpty(t,r);--r)e.push(new u(t,r));for(r=o+1;r<8&&this.board.isFieldEmpty(t,r);++r)e.push(new u(t,r));return e},t.prototype.getPossibleCaptures=function(){for(var e=[],t=this.point.row,o=this.point.col,i=t-1,r=o-1;i>=0&&r>=0;--i,--r){if(this.board.isFieldTakenByEnemy(i,r,this.color===l.WHITE?l.BLACK:l.WHITE)){e.push(new u(i,r));break}if(!this.board.isFieldEmpty(i,r))break}for(i=t-1,r=o+1;i>=0&&r<8;--i,++r){if(this.board.isFieldTakenByEnemy(i,r,this.color===l.WHITE?l.BLACK:l.WHITE)){e.push(new u(i,r));break}if(!this.board.isFieldEmpty(i,r))break}for(i=t+1,r=o-1;i<8&&r>=0;++i,--r){if(this.board.isFieldTakenByEnemy(i,r,this.color===l.WHITE?l.BLACK:l.WHITE)){e.push(new u(i,r));break}if(!this.board.isFieldEmpty(i,r))break}for(i=t+1,r=o+1;i<8&&r<8;++i,++r){if(this.board.isFieldTakenByEnemy(i,r,this.color===l.WHITE?l.BLACK:l.WHITE)){e.push(new u(i,r));break}if(!this.board.isFieldEmpty(i,r))break}for(i=t+1;i<8;++i){if(this.board.isFieldTakenByEnemy(i,o,this.color===l.WHITE?l.BLACK:l.WHITE)){e.push(new u(i,o));break}if(!this.board.isFieldEmpty(i,o))break}for(i=t-1;i>=0;--i){if(this.board.isFieldTakenByEnemy(i,o,this.color===l.WHITE?l.BLACK:l.WHITE)){e.push(new u(i,o));break}if(!this.board.isFieldEmpty(i,o))break}for(r=o-1;r>=0;--r){if(this.board.isFieldTakenByEnemy(t,r,this.color===l.WHITE?l.BLACK:l.WHITE)){e.push(new u(t,r));break}if(!this.board.isFieldEmpty(t,r))break}for(r=o+1;r<8;++r){if(this.board.isFieldTakenByEnemy(t,r,this.color===l.WHITE?l.BLACK:l.WHITE)){e.push(new u(t,r));break}if(!this.board.isFieldEmpty(t,r))break}return e},t.prototype.getCoveredFields=function(){for(var e=[],t=this.point.row,o=this.point.col,i=t+1;i<8;++i)if(this.board.isFieldEmpty(i,o))e.push(new u(i,o));else if(!(this.board.getPieceByField(i,o)instanceof f)){e.push(new u(i,o));break}for(i=t-1;i>=0;--i)if(this.board.isFieldEmpty(i,o))e.push(new u(i,o));else if(!(this.board.getPieceByField(i,o)instanceof f)){e.push(new u(i,o));break}for(var r=o-1;r>=0;--r)if(this.board.isFieldEmpty(t,r))e.push(new u(t,r));else if(!(this.board.getPieceByField(t,r)instanceof f)){e.push(new u(t,r));break}for(r=o+1;r<8;++r)if(this.board.isFieldEmpty(t,r))e.push(new u(t,r));else if(!(this.board.getPieceByField(t,r)instanceof f)){e.push(new u(t,r));break}for(i=t-1,r=o-1;i>=0&&r>=0;--i,--r)if(this.board.isFieldEmpty(i,r))e.push(new u(i,r));else if(!(this.board.getPieceByField(i,r)instanceof f)){e.push(new u(i,r));break}for(i=t-1,r=o+1;i>=0&&r<8;--i,++r)if(this.board.isFieldEmpty(i,r))e.push(new u(i,r));else if(!(this.board.getPieceByField(i,r)instanceof f)){e.push(new u(i,r));break}for(i=t+1,r=o-1;i<8&&r>=0;++i,--r)if(this.board.isFieldEmpty(i,r))e.push(new u(i,r));else if(!(this.board.getPieceByField(i,r)instanceof f)){e.push(new u(i,r));break}for(i=t+1,r=o+1;i<8&&r<8;++i,++r)if(this.board.isFieldEmpty(i,r))e.push(new u(i,r));else if(!(this.board.getPieceByField(i,r)instanceof f)){e.push(new u(i,r));break}return e},t}(p);var g={WHITE_KING:{name:"King",icon:"&#x2654;"},WHITE_QUEEN:{name:"Queen",icon:"&#x2655;"},WHITE_KNIGHT:{name:"Knight",icon:"&#x2658"},WHITE_ROOK:{name:"Rook",icon:"&#x2656"},WHITE_PAWN:{name:"Pawn",icon:"&#x2659"},WHITE_BISHOP:{name:"Bishop",icon:"&#x2657"},BLACK_KING:{name:"King",icon:"&#x265A"},BLACK_QUEEN:{name:"Queen",icon:"&#x265B"},BLACK_KNIGHT:{name:"Knight",icon:"&#x265E"},BLACK_ROOK:{name:"Rook",icon:"&#x265C"},BLACK_PAWN:{name:"Pawn",icon:"&#x265F"},BLACK_BISHOP:{name:"Bishop",icon:"&#x265D"}},C=function(){function e(e){this.board=e}return e.prototype.addPieces=function(){this.board.pieces=[];for(var e=0;e<8;++e)this.board.pieces.push(new v(new u(1,e),l.BLACK,g.BLACK_PAWN,this.board));this.board.pieces.push(new b(new u(0,0),l.BLACK,g.BLACK_ROOK,this.board)),this.board.pieces.push(new w(new u(0,1),l.BLACK,g.BLACK_KNIGHT,this.board)),this.board.pieces.push(new y(new u(0,2),l.BLACK,g.BLACK_BISHOP,this.board)),this.board.pieces.push(new E(new u(0,3),l.BLACK,g.BLACK_QUEEN,this.board)),this.board.pieces.push(new f(new u(0,4),l.BLACK,g.BLACK_KING,this.board)),this.board.pieces.push(new y(new u(0,5),l.BLACK,g.BLACK_BISHOP,this.board)),this.board.pieces.push(new w(new u(0,6),l.BLACK,g.BLACK_KNIGHT,this.board)),this.board.pieces.push(new b(new u(0,7),l.BLACK,g.BLACK_ROOK,this.board));for(e=0;e<8;++e)this.board.pieces.push(new v(new u(6,e),l.WHITE,g.WHITE_PAWN,this.board));this.board.pieces.push(new b(new u(7,0),l.WHITE,g.WHITE_ROOK,this.board)),this.board.pieces.push(new w(new u(7,1),l.WHITE,g.WHITE_KNIGHT,this.board)),this.board.pieces.push(new y(new u(7,2),l.WHITE,g.WHITE_BISHOP,this.board)),this.board.pieces.push(new E(new u(7,3),l.WHITE,g.WHITE_QUEEN,this.board)),this.board.pieces.push(new f(new u(7,4),l.WHITE,g.WHITE_KING,this.board)),this.board.pieces.push(new y(new u(7,5),l.WHITE,g.WHITE_BISHOP,this.board)),this.board.pieces.push(new w(new u(7,6),l.WHITE,g.WHITE_KNIGHT,this.board)),this.board.pieces.push(new b(new u(7,7),l.WHITE,g.WHITE_ROOK,this.board)),this.board.calculateFEN()},e.prototype.loadFEN=function(e){if(!e)throw Error("Incorrect FEN provided");this.board.reverted=!1,this.board.pieces=[];for(var t=e.split("/"),o=0;o<8;++o)for(var i=0,r=0;r<8;++r){var s=t[o].charAt(r);if(s.match(/[0-9]/))i+=Number(s);else{switch(s){case"r":this.board.pieces.push(new b(new u(o,i),l.BLACK,g.BLACK_ROOK,this.board));break;case"n":this.board.pieces.push(new w(new u(o,i),l.BLACK,g.BLACK_KNIGHT,this.board));break;case"b":this.board.pieces.push(new y(new u(o,i),l.BLACK,g.BLACK_BISHOP,this.board));break;case"q":this.board.pieces.push(new E(new u(o,i),l.BLACK,g.BLACK_QUEEN,this.board));break;case"k":this.board.pieces.push(new f(new u(o,i),l.BLACK,g.BLACK_KING,this.board));break;case"p":((n=new v(new u(o,i),l.BLACK,g.BLACK_PAWN,this.board)).color===l.BLACK&&1!==n.point.row||n.color===l.WHITE&&6!==n.point.row)&&(n.isMovedAlready=!0),this.board.pieces.push(n);break;case"R":this.board.pieces.push(new b(new u(o,i),l.WHITE,g.WHITE_ROOK,this.board));break;case"N":this.board.pieces.push(new w(new u(o,i),l.WHITE,g.WHITE_KNIGHT,this.board));break;case"B":this.board.pieces.push(new y(new u(o,i),l.WHITE,g.WHITE_BISHOP,this.board));break;case"Q":this.board.pieces.push(new E(new u(o,i),l.WHITE,g.WHITE_QUEEN,this.board));break;case"K":this.board.pieces.push(new f(new u(o,i),l.WHITE,g.WHITE_KING,this.board));break;case"P":var n;((n=new v(new u(o,i),l.WHITE,g.WHITE_PAWN,this.board)).color===l.BLACK&&1!==n.point.row||n.color===l.WHITE&&6!==n.point.row)&&(n.isMovedAlready=!0),this.board.pieces.push(n)}++i}}this.setCurrentPlayer(e),this.setCastles(e),this.setEnPassant(e),this.setFullMoveCount(e)},e.prototype.setBoard=function(e){this.board=e},e.prototype.setCurrentPlayer=function(e){if(e){var t=e.split(" ");this.board.currentWhitePlayer="w"===t[1]}},e.prototype.setCastles=function(e){if(e){var t=e.split(" ")[2];t.includes("K")||this.setRookAlreadyMoved(l.WHITE,7),t.includes("Q")||this.setRookAlreadyMoved(l.WHITE,0),t.includes("k")||this.setRookAlreadyMoved(l.BLACK,7),t.includes("q")||this.setRookAlreadyMoved(l.BLACK,0)}},e.prototype.setFullMoveCount=function(e){},e.prototype.setEnPassant=function(e){if(e&&"-"===e.split(" ")[3])return},e.prototype.setRookAlreadyMoved=function(e,t){this.board.pieces.find((function(o){return o.color===e&&o instanceof b&&o.point.col===t})).isMovedAlready=!0},e}();var I=function(e){this.board=e};var P=function(){function e(){this.statesSubject$=new r.BehaviorSubject([])}return Object.defineProperty(e.prototype,"states",{get:function(){return this.statesSubject$.value},set:function(e){this.statesSubject$.next(e)},enumerable:!0,configurable:!0}),e.prototype.addMove=function(e){this.states=d(this.states,[e])},e.prototype.getStates=function(){return this.states},e.prototype.pop=function(){var e=this.getLastState();return this.states=this.states.filter((function(t){return t!==e})),e},e.prototype.isEmpty=function(){return 0===this.states.length},e.prototype.clear=function(){this.states=[]},e.prototype.getLastState=function(){return this.states[this.getLastStateIndex()]},e.prototype.getLastStateIndex=function(){return this.states.length-1},e}();var m=function(){function e(){this.defaultXCoords=["a","b","c","d","e","f","g","h"],this.reversedXCoords=["h","g","f","e","d","c","b","a"],this.defaultYCoords=[8,7,6,5,4,3,2,1],this.reversedYCoords=[1,2,3,4,5,6,7,8],this.currentXCoords=this.defaultXCoords,this.currentYCoords=this.defaultYCoords}return Object.defineProperty(e.prototype,"xCoords",{get:function(){return this.currentXCoords},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"yCoords",{get:function(){return this.currentYCoords},enumerable:!0,configurable:!0}),e.prototype.reverse=function(){this.currentXCoords=this.reversedXCoords,this.currentYCoords=this.reversedYCoords},e.prototype.reset=function(){this.init()},e.prototype.init=function(){this.currentXCoords=this.defaultXCoords,this.currentYCoords=this.defaultYCoords},e}();var k=function(){function e(){}return e.prototype.isEqual=function(e){return e&&this.start.isEqual(e.start)&&this.end.isEqual(e.end)},e}();var T=function(){function e(){}return e.prototype.isEqual=function(e){return e&&this.drawPoint.isEqual(e.drawPoint)},e}();var B=function(){function e(e,t,o){this.x=e+.5,this.y=t+.5,this.color=o}return e.prototype.isEqual=function(e){return e&&e.x===this.x&&this.y===e.y},e}();var A=function(){function e(){this.arrowsSubject$=new r.BehaviorSubject([]),this.circlesSubject$=new r.BehaviorSubject([]),this.arrows$=this.arrowsSubject$.asObservable(),this.circles$=this.circlesSubject$.asObservable()}return Object.defineProperty(e.prototype,"circles",{get:function(){return this.circlesSubject$.value},set:function(e){this.circlesSubject$.next(e)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"arrows",{get:function(){return this.arrowsSubject$.value},set:function(e){this.arrowsSubject$.next(e)},enumerable:!0,configurable:!0}),e.prototype.addCircle=function(e){this.circles=d(this.circles,[e])},e.prototype.reomveCircle=function(e){this.circles=this.circles.filter((function(t){return!t.isEqual(e)}))},e.prototype.addArrow=function(e){this.arrows=d(this.arrows,[e])},e.prototype.removeArrow=function(e){this.arrows=this.arrows.filter((function(t){return!t.isEqual(e)}))},e.prototype.containsCircle=function(e){return this.circles.some((function(t){return t.isEqual(e)}))},e.prototype.containsArrow=function(e){return this.arrows.some((function(t){return t.isEqual(e)}))},e.prototype.clear=function(){this.arrows=[],this.circles=[]},e}();var W=function(e,t,o,i){this.move=e,this.piece=t,this.color=o,this.x=i};var F=function(){function e(){this.historyMovesSubject$=new r.BehaviorSubject([])}return Object.defineProperty(e.prototype,"historyMoves",{get:function(){return this.historyMovesSubject$.value},set:function(e){this.historyMovesSubject$.next(e)},enumerable:!0,configurable:!0}),e.prototype.addMove=function(e){this.historyMoves=d(this.historyMoves,[e])},e.prototype.pop=function(){var e=this.getLastMove();return this.historyMoves=this.historyMoves.filter((function(t){return t!==e})),e},e.prototype.getAll=function(){return this.historyMoves},e.prototype.clear=function(){this.historyMoves=[]},e.prototype.getLastMove=function(){return this.historyMoves[this.getLastMoveIndex()]},e.prototype.getLastMoveIndex=function(){return this.historyMoves.length-1},e}();var H=function(){function e(){this.board=[],this.pieces=[],this.enPassantPoint=null,this.enPassantPiece=null,this.lastMoveSrc=null,this.lastMoveDest=null,this.possibleCaptures=[],this.possibleMoves=[],this.currentWhitePlayer=!0,this.reverted=!1,this.fullMoveCount=1;for(var e=0;e<8;++e){this.board[e]=[];for(var t=0;t<8;++t)this.board[e][t]=0}}return e.prototype.isXYInPossibleMoves=function(e,t){return this.possibleMoves.some((function(o){return o.row===e&&o.col===t}))},e.prototype.isXYInPossibleCaptures=function(e,t){return this.possibleCaptures.some((function(o){return o.row===e&&o.col===t}))},e.prototype.isXYInSourceMove=function(e,t){return this.lastMoveSrc&&this.lastMoveSrc.row===e&&this.lastMoveSrc.col===t},e.prototype.isXYInDestMove=function(e,t){return this.lastMoveDest&&this.lastMoveDest.row===e&&this.lastMoveDest.col===t},e.prototype.isXYInActiveMove=function(e,t){return this.activePiece&&this.activePiece.point.row===e&&this.activePiece.point.col===t},e.prototype.isPointInPossibleMoves=function(e){return this.possibleMoves.some((function(t){return t.row===e.row&&t.col===e.col}))},e.prototype.isPointInPossibleCaptures=function(e){return this.possibleCaptures.some((function(t){return t.row===e.row&&t.col===e.col}))},e.prototype.reset=function(){this.lastMoveDest=null,this.lastMoveSrc=null,this.whiteKingChecked=!1,this.blackKingChecked=!1,this.possibleCaptures=[],this.possibleMoves=[],this.activePiece=null,this.reverted=!1,this.currentWhitePlayer=!0,this.enPassantPoint=null,this.enPassantPiece=null,this.fullMoveCount=1,this.calculateFEN()},e.prototype.reverse=function(){var e=this;this.reverted=!this.reverted,this.activePiece=null,this.possibleMoves=[],this.possibleCaptures=[],this.pieces.forEach((function(t){return e.reversePoint(t.point)})),this.reversePoint(this.lastMoveSrc),this.enPassantPoint&&this.enPassantPiece&&this.reversePoint(this.enPassantPoint)},e.prototype.clone=function(){return s.cloneDeep(this)},e.prototype.isFieldTakenByEnemy=function(e,t,o){return!(e>7||e<0||t>7||t<0)&&this.pieces.some((function(i){return i.point.col===t&&i.point.row===e&&i.color===o}))},e.prototype.isFieldEmpty=function(e,t){return!(e>7||e<0||t>7||t<0)&&!this.pieces.some((function(o){return o.point.col===t&&o.point.row===e}))},e.prototype.isFieldUnderAttack=function(e,t,o){return this.pieces.filter((function(e){return e.color===o})).some((function(o){return o.getCoveredFields().some((function(o){return o.col===t&&o.row===e}))}))},e.prototype.getPieceByField=function(e,t){if(!this.isFieldEmpty(e,t))return this.pieces.find((function(o){return o.point.col===t&&o.point.row===e}))},e.prototype.isKingInCheck=function(e,t){var o=t.find((function(t){return t.color===e&&t instanceof f}));return!!o&&t.some((function(t){return t.getPossibleCaptures().some((function(e){return e.col===o.point.col&&e.row===o.point.row}))&&t.color!==e}))},e.prototype.getKingByColor=function(e){return this.pieces.find((function(t){return t instanceof f&&t.color===e}))},e.prototype.getCastleFENString=function(e){var t=this.getKingByColor(e);if(t.isMovedAlready)return"";var o="",i=this.getPieceByField(t.point.row,0),r=this.getPieceByField(t.point.row,7);return r instanceof b&&r.color===e&&(r.isMovedAlready||(o+=this.reverted?"q":"k")),i instanceof b&&i.color===e&&(i.isMovedAlready||(o+=this.reverted?"k":"q")),o=o.split("").sort().join(""),e===l.BLACK?o:o.toUpperCase()},e.prototype.getEnPassantFENString=function(){return this.enPassantPoint?this.reverted?String.fromCharCode(104-this.enPassantPoint.col)+(this.enPassantPoint.row+1):String.fromCharCode(97+this.enPassantPoint.col)+(Math.abs(this.enPassantPoint.row-7)+1):"-"},e.prototype.calculateFEN=function(){for(var e="",t=function(t){for(var i=0,r=function(r){var s=o.pieces.find((function(e){return e.point.col===r&&e.point.row===t}));s?(i>0&&(e+=i,i=0),s instanceof b?e+=s.color===l.BLACK?"r":"R":s instanceof w?e+=s.color===l.BLACK?"n":"N":s instanceof y?e+=s.color===l.BLACK?"b":"B":s instanceof E?e+=s.color===l.BLACK?"q":"Q":s instanceof f?e+=s.color===l.BLACK?"k":"K":s instanceof v&&(e+=s.color===l.BLACK?"p":"P")):++i},s=0;s<8;++s)r(s);i>0&&(e+=i),e+="/"},o=this,i=0;i<8;++i)t(i);e=e.substr(0,e.length-1),this.reverted&&(e=e.split("").reverse().join("")),e+=" "+(this.currentWhitePlayer?"w":"b");var r=this.getCastleFENString(l.WHITE)+this.getCastleFENString(l.BLACK);r||(r="-"),e+=" "+r,e+=" "+this.getEnPassantFENString(),e+=" 0",e+=" "+this.fullMoveCount,this.fen=e},e.prototype.isXYInPointSelection=function(e,t){return!1},e.prototype.reversePoint=function(e){e&&(e.row=Math.abs(e.row-7),e.col=Math.abs(e.col-7))},e}();var K=function(){function e(e,t,o){this._xAxis=e,this._yAxis=t,this._reverted=o}return Object.defineProperty(e.prototype,"xAxis",{get:function(){return this._xAxis},set:function(e){this._xAxis=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"yAxis",{get:function(){return this._yAxis},set:function(e){this._yAxis=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"reverted",{get:function(){return this._reverted},set:function(e){this._reverted=e},enumerable:!0,configurable:!0}),e}();var L=function(){function e(){}return e.willMoveCauseCheck=function(e,t,o,i,r,s){var n=s.getPieceByField(t,o),a=s.getPieceByField(i,r);n&&(n.point.row=i,n.point.col=r),a&&(s.pieces=s.pieces.filter((function(e){return e!==a})));var c=s.isKingInCheck(e,s.pieces);return n&&(n.point.col=o,n.point.row=t),a&&s.pieces.push(a),c},e.format=function(e,t,o){if(o){var i=104-e.col,r=104-t.col;return String.fromCharCode(i)+(e.row+1)+String.fromCharCode(r)+(t.row+1)}return String.fromCharCode(e.col+97)+(Math.abs(e.row-7)+1)+String.fromCharCode(t.col+97)+(Math.abs(t.row-7)+1)},e.translateCoordsToIndex=function(e,t){var o,i;return t?(o=104-e.charCodeAt(0),i=+e.charAt(1)-1):(o=e.charCodeAt(0)-97,i=Math.abs(+e.charAt(1)-8)),new K(o,i,t)},e}(),M=function(e){this.piece=e};var x=function(e){function t(t,o,i,r){var s=e.call(this,t)||this;return s.pointClicked=o,s.color=i,s.board=r,s}return a(t,e),t.prototype.getPossibleCaptures=function(){var e=this;return this.piece.getPossibleCaptures().filter((function(t){return!L.willMoveCauseCheck(e.color,e.pointClicked.row,e.pointClicked.col,t.row,t.col,e.board)}))},t.prototype.getPossibleMoves=function(){var e=this;return this.piece.getPossibleMoves().filter((function(t){return!L.willMoveCauseCheck(e.color,e.pointClicked.row,e.pointClicked.col,t.row,t.col,e.board)}))},t}(M);var S=function(){function e(){this.selectedIndex=0,this.Color=l,this.opened=!1}return e.prototype.open=function(e,t){this.opened=!0,this.color=e,this.onCloseCallback=t,this.modal.nativeElement.style.display="block"},e.prototype.changeSelection=function(e){this.modal.nativeElement.style.display="none",this.opened=!1,this.onCloseCallback(e)},e.decorators=[{type:i.Component,args:[{selector:"app-piece-promotion-modal",template:'<div\r\n    class="container"\r\n    #modal\r\n>\r\n    <div class="wrapper">\r\n        <div\r\n            class="piece"\r\n            [class.black-bishop]="piece === \'bishop\' && color === Color.BLACK"\r\n            [class.black-knight]="piece === \'knight\' && color === Color.BLACK"\r\n            [class.black-queen]="piece === \'queen\' && color === Color.BLACK"\r\n            [class.black-rook]="piece === \'rook\' && color === Color.BLACK"\r\n            [class.selected]="selectedIndex === index + 1"\r\n            [class.white-bishop]="piece === \'bishop\' && color === Color.WHITE"\r\n            [class.white-knight]="piece === \'knight\' && color === Color.WHITE"\r\n            [class.white-queen]="piece === \'queen\' && color === Color.WHITE"\r\n            [class.white-rook]="piece === \'rook\' && color === Color.WHITE"\r\n            (click)="changeSelection(index + 1)"\r\n            *ngFor="let piece of [\'queen\', \'rook\', \'bishop\', \'knight\']; let index = index"\r\n        >\r\n        </div>\r\n    </div>\r\n</div>\r\n',styles:[".container{display:none;position:absolute;z-index:1;top:0;color:#000;width:100%;height:100%;overflow:auto;background-color:rgba(0,0,0,.4)}.wrapper{display:flex;background-color:#fff}.content{height:100%}.piece{width:25%;background-repeat:no-repeat;cursor:pointer;background-size:100%;margin:10px;height:100px;border:2px solid grey;border-radius:4px;box-sizing:border-box}.piece:hover{background-color:rgba(0,0,0,.2)}#close-button{border-radius:4px;background-color:#4caf50;border:none;color:#fff;padding-left:5px;padding-right:5px;text-align:center;text-decoration:none;display:inline-block}.selected{border:2px solid #00b919}"]}]}],e.propDecorators={modal:[{type:i.ViewChild,args:["modal",{static:!1}]}]},e}();var _=function(){function e(){this.componentMethodCallSource=new r.Subject,this.componentMethodCalled$=this.componentMethodCallSource.asObservable()}return e.prototype.reset=function(){this.componentMethodCallSource.next()},e.decorators=[{type:i.Injectable,args:[{providedIn:"root"}]}],e.ngInjectableDef=i.ɵɵdefineInjectable({factory:function(){return new e},token:e,providedIn:"root"}),e}();var O=function(){function e(){}return e.DEFAULT_DARK_TILE_COLOR="rgb(97, 84, 61)",e.DEFAULT_LIGHT_TILE_COLOR="#BAA378",e.DEFAULT_SIZE=500,e.MIN_BOARD_SIZE=100,e.MAX_BOARD_SIZE=4e3,e}();var D=function(){function e(){this._defaultIcons=!1}return Object.defineProperty(e.prototype,"pieceIconInput",{get:function(){return this._pieceIconInput},set:function(e){this._pieceIconInput=e},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"defaultIcons",{get:function(){return this._defaultIcons},set:function(e){this._defaultIcons=e},enumerable:!0,configurable:!0}),e.prototype.isDefaultIcons=function(){return void 0===this.pieceIconInput||null===this.pieceIconInput},e.prototype.getPieceIcon=function(e){var t=e.color===l.WHITE;switch(e.constructor){case f:return t?this.pieceIconInput.whiteKingUrl:this.pieceIconInput.blackKingUrl;case E:return t?this.pieceIconInput.whiteQueenUrl:this.pieceIconInput.blackQueenUrl;case b:return t?this.pieceIconInput.whiteRookUrl:this.pieceIconInput.blackRookUrl;case y:return t?this.pieceIconInput.whiteBishopUrl:this.pieceIconInput.blackBishopUrl;case w:return t?this.pieceIconInput.whiteKnightUrl:this.pieceIconInput.blackKnightUrl;case v:return t?this.pieceIconInput.whitePawnUrl:this.pieceIconInput.blackPawnUrl}},e.prototype.loadDefaultData=function(){this.pieceIconInput={blackBishopUrl:"",blackKingUrl:"",blackKnightUrl:"",blackQueenUrl:"",blackRookUrl:"",whiteBishopUrl:"",whiteKingUrl:"",whiteKnightUrl:"",whitePawnUrl:"",whiteQueenUrl:"",whiteRookUrl:"",blackPawnUrl:"a"}},e}();var j=function(){function e(e){this.ngxChessBoardService=e,this.darkTileColor=O.DEFAULT_DARK_TILE_COLOR,this.lightTileColor=O.DEFAULT_LIGHT_TILE_COLOR,this.showCoords=!0,this.dragDisabled=!1,this.drawDisabled=!1,this.lightDisabled=!1,this.darkDisabled=!1,this.moveChange=new i.EventEmitter,this.checkmate=new i.EventEmitter,this.stalemate=new i.EventEmitter,this.selected=!1,this.coords=new m,this.disabling=!1,this.heightAndWidth=O.DEFAULT_SIZE,this.board=new H,this.boardLoader=new C(this.board),this.boardLoader.addPieces(),this.boardStateProvider=new P,this.moveHistoryProvider=new F,this.drawProvider=new A,this.pieceIconManager=new D}return Object.defineProperty(e.prototype,"size",{set:function(e){e&&e>=O.MIN_BOARD_SIZE&&e<=O.MAX_BOARD_SIZE?this.heightAndWidth=e:this.heightAndWidth=O.DEFAULT_SIZE,this.drawProvider.clear(),this.calculatePieceSize()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"pieceIcons",{set:function(e){this.pieceIconManager.pieceIconInput=e},enumerable:!0,configurable:!0}),e.prototype.onRightClick=function(e){e.preventDefault()},e.prototype.ngOnChanges=function(e){(e.lightDisabled&&this.lightDisabled&&this.board.currentWhitePlayer||e.darkDisabled&&this.darkDisabled&&!this.board.currentWhitePlayer)&&(this.board.possibleCaptures=[],this.board.possibleMoves=[])},e.prototype.ngOnInit=function(){var e=this;this.ngxChessBoardService.componentMethodCalled$.subscribe((function(){e.board.reset()})),this.calculatePieceSize()},e.prototype.onMouseUp=function(e){if(0===e.button||this.drawDisabled){if(this.drawProvider.clear(),!this.dragDisabled){var t=this.getClickPoint(e);if(this.board.activePiece&&t.isEqual(this.board.activePiece.point)&&this.disabling)return this.disableSelection(),void(this.disabling=!1);var o=this.getPieceByPoint(t.row,t.col);if(!this.isPieceDisabled(o))if(this.selected)this.handleClickEvent(t);else if(o){if(this.board.currentWhitePlayer&&o.color===l.BLACK||!this.board.currentWhitePlayer&&o.color===l.WHITE)return;this.prepareActivePiece(o,t)}}}else this.addDrawPoint(e.x,e.y,e.ctrlKey,e.altKey,e.shiftKey)},e.prototype.afterMoveActions=function(e){this.checkIfPawnFirstMove(this.board.activePiece),this.checkIfRookMoved(this.board.activePiece),this.checkIfKingMoved(this.board.activePiece),this.board.blackKingChecked=this.board.isKingInCheck(l.BLACK,this.board.pieces),this.board.whiteKingChecked=this.board.isKingInCheck(l.WHITE,this.board.pieces);var t=this.board.blackKingChecked||this.board.whiteKingChecked,o=this.checkForPossibleMoves(l.BLACK)||this.checkForPossibleMoves(l.WHITE),i=this.checkForPat(l.BLACK)||this.checkForPat(l.WHITE);this.disabling=!1,this.board.calculateFEN();var r=this.moveHistoryProvider.getLastMove();r&&e&&(r.move+=e),this.moveChange.emit(c({},r,{check:t,checkmate:o,stalemate:i,fen:this.board.fen}))},e.prototype.disableSelection=function(){this.selected=!1,this.board.possibleCaptures=[],this.board.activePiece=null,this.board.possibleMoves=[]},e.prototype.prepareActivePiece=function(e,t){this.board.activePiece=e,this.selected=!0,this.board.possibleCaptures=new x(e,t,this.board.currentWhitePlayer?l.WHITE:l.BLACK,this.board).getPossibleCaptures(),this.board.possibleMoves=new x(e,t,this.board.currentWhitePlayer?l.WHITE:l.BLACK,this.board).getPossibleMoves()},e.prototype.getPieceByPoint=function(e,t){return e=Math.floor(e),t=Math.floor(t),this.board.pieces.find((function(o){return o.point.col===t&&o.point.row===e}))},e.prototype.isKingChecked=function(e){if(e instanceof f)return e.color===l.WHITE?this.board.whiteKingChecked:this.board.blackKingChecked},e.prototype.getClickPoint=function(e){return new u(Math.floor((e.y-this.boardRef.nativeElement.getBoundingClientRect().top)/(this.boardRef.nativeElement.getBoundingClientRect().height/8)),Math.floor((e.x-this.boardRef.nativeElement.getBoundingClientRect().left)/(this.boardRef.nativeElement.getBoundingClientRect().width/8)))},e.prototype.movePiece=function(e,t,o){var i=this.board.pieces.find((function(e){return e.point.col===t.col&&e.point.row===t.row}));if(i&&e.color!==i.color)this.board.pieces=this.board.pieces.filter((function(e){return e!==i}));else if(i&&e.color===i.color)return;var r=new W(L.format(e.point,t,this.board.reverted),e.constant.name,e.color===l.WHITE?"white":"black",!!i);(this.moveHistoryProvider.addMove(r),e instanceof f)&&(Math.abs(t.col-e.point.col)>1&&(t.col<3?this.board.getPieceByField(e.point.row,0).point.col=this.board.reverted?2:3:this.board.getPieceByField(e.point.row,7).point.col=this.board.reverted?4:5));e instanceof v&&(this.checkIfPawnTakesEnPassant(t),this.checkIfPawnEnpassanted(e,t)),e.point=t,this.increaseFullMoveCount(),this.board.currentWhitePlayer=!this.board.currentWhitePlayer,this.checkForPawnPromote(e,o)||this.afterMoveActions()},e.prototype.checkIfPawnFirstMove=function(e){e instanceof v&&(e.isMovedAlready=!0)},e.prototype.checkForPawnPromote=function(e,t){if(e instanceof v)return 0===e.point.row||7===e.point.row?(this.board.pieces=this.board.pieces.filter((function(t){return t!==e})),t?(this.resolvePromotionChoice(e,t),this.afterMoveActions(t)):this.openPromoteDialog(e),!0):void 0},e.prototype.openPromoteDialog=function(e){var t=this;this.modal.open(e.color,(function(o){t.resolvePromotionChoice(e,o),t.afterMoveActions(o)}))},e.prototype.resolvePromotionChoice=function(e,t){var o=e.color===l.WHITE;switch(t){case 1:this.board.pieces.push(new E(e.point,e.color,o?g.WHITE_QUEEN:g.BLACK_QUEEN,this.board));break;case 2:this.board.pieces.push(new b(e.point,e.color,o?g.WHITE_ROOK:g.BLACK_ROOK,this.board));break;case 3:this.board.pieces.push(new y(e.point,e.color,o?g.WHITE_BISHOP:g.BLACK_BISHOP,this.board));break;case 4:this.board.pieces.push(new w(e.point,e.color,o?g.WHITE_KNIGHT:g.BLACK_KNIGHT,this.board))}},e.prototype.reset=function(){this.boardStateProvider.clear(),this.moveHistoryProvider.clear(),this.boardLoader.addPieces(),this.board.reset(),this.coords.reset(),this.drawProvider.clear()},e.prototype.reverse=function(){this.selected=!1,this.board.reverse(),this.coords.reverse()},e.prototype.updateBoard=function(e){this.board=e,this.boardLoader.setBoard(this.board),this.board.possibleCaptures=[],this.board.possibleMoves=[]},e.prototype.undo=function(){if(!this.boardStateProvider.isEmpty()){var e=this.boardStateProvider.pop().board;this.board.reverted&&e.reverse(),this.board=e,this.boardLoader.setBoard(this.board),this.board.possibleCaptures=[],this.board.possibleMoves=[],this.moveHistoryProvider.pop()}},e.prototype.getMoveHistory=function(){return this.moveHistoryProvider.getAll()},e.prototype.setFEN=function(e){try{this.boardLoader.loadFEN(e),this.board.possibleCaptures=[],this.board.possibleMoves=[]}catch(e){this.boardLoader.addPieces()}},e.prototype.getFEN=function(){return this.board.fen},e.prototype.dragEnded=function(e){e.source.reset(),e.source.element.nativeElement.style.zIndex="0",e.source.element.nativeElement.style.pointerEvents="auto",e.source.element.nativeElement.style.touchAction="auto"},e.prototype.dragStart=function(e){var t=e.source.element.nativeElement.style;t.position="relative",t.zIndex="1000",t.touchAction="none",t.pointerEvents="none"},e.prototype.onMouseDown=function(e){if(0===e.button){var t=this.getClickPoint(e);if(this.drawProvider.clear(),this.board.activePiece&&t.isEqual(this.board.activePiece.point))this.disabling=!0;else{var o=this.getPieceByPoint(t.row,t.col);if(!this.isPieceDisabled(o))if(this.selected)this.handleClickEvent(t);else if(o){if(this.board.currentWhitePlayer&&o.color===l.BLACK||!this.board.currentWhitePlayer&&o.color===l.WHITE)return;this.prepareActivePiece(o,t)}}}else this.drawPoint=this.getDrawingPoint(e.x,e.y,e.ctrlKey,e.altKey,e.shiftKey)},e.prototype.getDrawingPoint=function(e,t,o,i,r){var s=this.heightAndWidth/8,n=Math.floor((e-this.boardRef.nativeElement.getBoundingClientRect().left)/s),a=Math.floor((t-this.boardRef.nativeElement.getBoundingClientRect().top)/s),c="green";return(o||r)&&(c="red"),i&&(c="blue"),(r||o)&&i&&(c="orange"),new B(Math.floor(n*s+s/2),Math.floor(a*s+s/2),c)},e.prototype.checkIfRookMoved=function(e){e instanceof b&&(e.isMovedAlready=!0)},e.prototype.checkIfKingMoved=function(e){e instanceof f&&(e.isMovedAlready=!0)},e.prototype.checkForPossibleMoves=function(e){var t=this;return!this.board.pieces.filter((function(t){return t.color===e})).some((function(o){return o.getPossibleMoves().some((function(i){return!L.willMoveCauseCheck(e,o.point.row,o.point.col,i.row,i.col,t.board)}))||o.getPossibleCaptures().some((function(i){return!L.willMoveCauseCheck(e,o.point.row,o.point.col,i.row,i.col,t.board)}))}))},e.prototype.checkForPat=function(e){return(e!==l.WHITE||this.board.whiteKingChecked)&&(e!==l.BLACK||this.board.blackKingChecked)?void 0:this.checkForPossibleMoves(e)},e.prototype.checkIfPawnEnpassanted=function(e,t){Math.abs(e.point.row-t.row)>1?(this.board.enPassantPiece=e,this.board.enPassantPoint=new u((e.point.row+t.row)/2,e.point.col)):(this.board.enPassantPoint=null,this.board.enPassantPiece=null)},e.prototype.checkIfPawnTakesEnPassant=function(e){var t=this;e.isEqual(this.board.enPassantPoint)&&(this.board.pieces=this.board.pieces.filter((function(e){return e!==t.board.enPassantPiece})),this.board.enPassantPoint=null,this.board.enPassantPiece=null)},e.prototype.saveClone=function(){var e=this.board.clone();this.board.reverted&&e.reverse(),this.boardStateProvider.addMove(new I(e))},e.prototype.saveMoveClone=function(){var e=this.board.clone();this.board.reverted&&e.reverse(),this.moveStateProvider.addMove(new I(e))},e.prototype.calculatePieceSize=function(){this.pieceSize=this.heightAndWidth/10},e.prototype.increaseFullMoveCount=function(){this.board.currentWhitePlayer||++this.board.fullMoveCount},e.prototype.handleClickEvent=function(e){(this.board.isPointInPossibleMoves(e)||this.board.isPointInPossibleCaptures(e))&&(this.saveClone(),this.board.lastMoveSrc=new u(this.board.activePiece.point.row,this.board.activePiece.point.col),this.board.lastMoveDest=e,this.movePiece(this.board.activePiece,e)),this.disableSelection();var t=this.getPieceByPoint(e.row,e.col);if(t){if(this.board.currentWhitePlayer&&t.color===l.BLACK||!this.board.currentWhitePlayer&&t.color===l.WHITE)return;this.prepareActivePiece(t,e)}},e.prototype.addDrawPoint=function(e,t,o,i,r){var s=this.getDrawingPoint(e,t,o,i,r);if(this.drawPoint.isEqual(s)){var n=new T;n.drawPoint=s,this.drawProvider.containsCircle(n)?this.drawProvider.reomveCircle(n):this.drawProvider.addCircle(n)}else{var a=new k;a.start=this.drawPoint,a.end=s,this.drawProvider.containsArrow(a)?this.drawProvider.removeArrow(a):this.drawProvider.addArrow(a)}},e.prototype.move=function(e){if(e){var t=L.translateCoordsToIndex(e.substring(0,2),this.board.reverted),o=L.translateCoordsToIndex(e.substring(2,4),this.board.reverted),i=this.getPieceByPoint(t.yAxis,t.xAxis);if(i){if(this.board.currentWhitePlayer&&i.color===l.BLACK||!this.board.currentWhitePlayer&&i.color===l.WHITE)return;this.prepareActivePiece(i,i.point),this.board.isPointInPossibleMoves(new u(o.yAxis,o.xAxis))||this.board.isPointInPossibleCaptures(new u(o.yAxis,o.xAxis))?(this.saveClone(),this.movePiece(i,new u(o.yAxis,o.xAxis),5===e.length?+e.substring(4,5):0),this.board.lastMoveSrc=new u(t.yAxis,t.xAxis),this.board.lastMoveDest=new u(o.yAxis,o.xAxis),this.disableSelection()):this.disableSelection()}}},e.prototype.getCustomPieceIcons=function(e){return JSON.parse('{ "background-image": "url(\''+this.pieceIconManager.getPieceIcon(e)+"')\"}")},e.prototype.isPieceDisabled=function(e){if(e&&e.point&&this.board.possibleCaptures.find((function(t){return t.col===e.point.col&&t.row===e.point.row})))return!1;return e&&(this.lightDisabled&&e.color===l.WHITE||this.darkDisabled&&e.color===l.BLACK)},e.decorators=[{type:i.Component,args:[{selector:"ngx-chess-board",template:'<div\r\n    id="board"\r\n    [style.height.px]="heightAndWidth"\r\n    [style.width.px]="heightAndWidth"\r\n    (pointerdown)="!modal.opened && onMouseDown($event)"\r\n    (pointerup)="!modal.opened && onMouseUp($event)"\r\n    #boardRef\r\n>\r\n    <div id="drag">\r\n        <div\r\n            class="board-row"\r\n            *ngFor="let row of board.board; let i = index"\r\n        >\r\n            <div\r\n                class="board-col"\r\n                [class.current-selection]="board.isXYInActiveMove(i,j)"\r\n                [class.dest-move]="board.isXYInDestMove(i,j)"\r\n                [class.king-check]=" isKingChecked(getPieceByPoint(i,j))"\r\n                [class.point-circle]="board.isXYInPointSelection(i, j)"\r\n                [class.possible-capture]="board.isXYInPossibleCaptures(i, j)"\r\n                [class.possible-point]="board.isXYInPossibleMoves(i, j)"\r\n                [class.source-move]="board.isXYInSourceMove(i, j)"\r\n                [style.background-color]="((i + j) % 2 === 0 ) ? lightTileColor : darkTileColor"\r\n                *ngFor="let col of row; let j = index"\r\n            >\r\n                <span\r\n                    class="yCoord"\r\n                    [style.color]="(i % 2 === 0) ? lightTileColor : darkTileColor"\r\n                    [style.font-size.px]="pieceSize / 4"\r\n                    *ngIf="showCoords && j === 7"\r\n                >\r\n                    {{coords.yCoords[i]}}\r\n                </span>\r\n                <span\r\n                    class="xCoord"\r\n                    [style.color]="(j % 2 === 0) ? lightTileColor : darkTileColor"\r\n                    [style.font-size.px]="pieceSize / 4"\r\n                    *ngIf="showCoords && i === 7"\r\n                >\r\n                    {{coords.xCoords[j]}}\r\n                </span>\r\n                <div\r\n                    *ngIf="getPieceByPoint(i, j) as piece"\r\n                    style="height:100%; width:100%"\r\n                >\r\n                    <div\r\n                        [cdkDragDisabled]="dragDisabled"\r\n                        [innerHTML]="pieceIconManager.isDefaultIcons() ? getPieceByPoint(i,j).constant.icon : \'\'"\r\n                        [ngClass]="\'piece\'"\r\n                        [style.font-size]="pieceSize + \'px\'"\r\n                        [ngStyle]="pieceIconManager.isDefaultIcons() ? \'\' : getCustomPieceIcons(getPieceByPoint(i,j))"\r\n                        (cdkDragEnded)="dragEnded($event)"\r\n                        (cdkDragStarted)="dragStart($event)"\r\n                        cdkDrag\r\n                    >\r\n                    </div>\r\n                </div>\r\n            </div>\r\n        </div>\r\n    </div>\r\n    <svg\r\n        [attr.height]="heightAndWidth"\r\n        [attr.width]="heightAndWidth"\r\n        style="position:absolute; top:0; pointer-events: none"\r\n    >\r\n        <defs *ngFor="let color of [\'red\', \'green\', \'blue\', \'orange\']">\r\n            <marker\r\n                [id]="color + \'Arrow\'"\r\n                markerHeight="13"\r\n                markerWidth="13"\r\n                orient="auto"\r\n                refX="9"\r\n                refY="6"\r\n            >\r\n                <path\r\n                    [style.fill]="color"\r\n                    d="M2,2 L2,11 L10,6 L2,2"\r\n                ></path>\r\n            </marker>\r\n        </defs>\r\n        <line\r\n            class="arrow"\r\n            [attr.marker-end]="\'url(#\' + arrow.end.color + \'Arrow)\'"\r\n            [attr.stroke]="arrow.end.color"\r\n            [attr.x1]="arrow.start.x"\r\n            [attr.x2]="arrow.end.x"\r\n            [attr.y1]="arrow.start.y"\r\n            [attr.y2]="arrow.end.y"\r\n            *ngFor="let arrow of drawProvider.arrows$ | async"\r\n        ></line>\r\n        <circle\r\n            [attr.cx]="circle.drawPoint.x"\r\n            [attr.cy]="circle.drawPoint.y"\r\n            [attr.r]="heightAndWidth / 18"\r\n            [attr.stroke]="circle.drawPoint.color"\r\n            *ngFor="let circle of drawProvider.circles$ | async"\r\n            fill-opacity="0.0"\r\n            stroke-width="2"\r\n        ></circle>\r\n    </svg>\r\n    <app-piece-promotion-modal #modal></app-piece-promotion-modal>\r\n</div>\r\n',styles:['@charset "UTF-8";#board{font-family:"Courier New",serif;position:relative}.board-row{display:block;width:100%;height:12.5%;position:relative}.board-col{position:relative;display:inline-block;width:12.5%;vertical-align:top;cursor:default;height:100%}.piece{height:100%;cursor:-webkit-grab;cursor:grab;width:100%;-moz-user-select:none;-ms-user-select:none;user-select:none;-webkit-user-select:none;background-size:cover;justify-content:center;text-align:center;color:#000!important}.piece::after{content:"​"}#drag{height:100%;width:100%}.possible-point{background:radial-gradient(rgba(20,85,30,.5) 19%,rgba(0,0,0,0) 20%)}.possible-capture:hover,.possible-point:hover{opacity:.4}.possible-capture{background:radial-gradient(transparent 0,transparent 80%,rgba(20,85,0,.3) 80%);box-sizing:border-box}.king-check{background:radial-gradient(ellipse at center,red 0,#e70000 25%,rgba(169,0,0,0) 89%,rgba(158,0,0,0) 100%)}.source-move{background-color:rgba(146,111,26,.79)!important}.dest-move{background-color:#b28e1a!important}.current-selection{background-color:rgba(255,255,255,.5)!important}.yCoord{position:absolute;-moz-user-select:none;-ms-user-select:none;user-select:none;-webkit-user-select:none;cursor:pointer;right:.2em;font-family:"Lucida Console",Courier,monospace;box-sizing:border-box}.xCoord{position:absolute;-moz-user-select:none;-ms-user-select:none;user-select:none;-webkit-user-select:none;cursor:pointer;left:.2em;bottom:0;font-family:"Lucida Console",Courier,monospace;box-sizing:border-box}.hovering{background-color:red!important}.arrow{stroke-width:2}svg{-webkit-filter:drop-shadow(1px 1px 0 #111) drop-shadow(-1px 1px 0 #111) drop-shadow(1px -1px 0 #111) drop-shadow(-1px -1px 0 #111);filter:drop-shadow(1px 1px 0 #111) drop-shadow(-1px 1px 0 #111) drop-shadow(1px -1px 0 #111) drop-shadow(-1px -1px 0 #111)}']}]}],e.ctorParameters=function(){return[{type:_}]},e.propDecorators={darkTileColor:[{type:i.Input}],lightTileColor:[{type:i.Input}],showCoords:[{type:i.Input}],dragDisabled:[{type:i.Input}],drawDisabled:[{type:i.Input}],lightDisabled:[{type:i.Input}],darkDisabled:[{type:i.Input}],moveChange:[{type:i.Output}],checkmate:[{type:i.Output}],stalemate:[{type:i.Output}],boardRef:[{type:i.ViewChild,args:["boardRef",{static:!1}]}],modal:[{type:i.ViewChild,args:["modal",{static:!1}]}],size:[{type:i.Input,args:["size"]}],pieceIcons:[{type:i.Input,args:["pieceIcons"]}],onRightClick:[{type:i.HostListener,args:["contextmenu",["$event"]]}]},e}();var U=function(){function e(){}return e.forRoot=function(){return{ngModule:e,providers:[_]}},e.decorators=[{type:i.NgModule,args:[{declarations:[j,S],imports:[o.CommonModule,t.DragDropModule],exports:[j]}]}],e}();e.HistoryMove=W,e.NgxChessBoardComponent=j,e.NgxChessBoardModule=U,e.NgxChessBoardService=_,e.PiecePromotionModalComponent=S,Object.defineProperty(e,"__esModule",{value:!0})}));
//# sourceMappingURL=ngx-chess-board.umd.min.js.map